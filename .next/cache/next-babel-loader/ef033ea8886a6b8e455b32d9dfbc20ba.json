{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport { Button, Form, Input, Message } from 'semantic-ui-react';\nimport { Link, Router } from '../../../routes';\nimport Layout from '../../../components/Layout';\nimport web3 from '../../../ethereum/academic/web3';\nimport verify from '../../../ethereum/academic/verify';\nimport CryptoJS from 'crypto-js';\n\nclass UploadIndex extends Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      selectedFile: null,\n      hashValue: '',\n      newSchool: '',\n      errorMessage: '',\n      loading: false\n    });\n\n    _defineProperty(this, \"onFileChange\", event => {\n      this.setState({\n        selectedFile: event.target.files[0],\n        errorMessage: ''\n      });\n      const curFile = event.target.files[0];\n      const reader = new FileReader();\n      var that = this;\n      reader.readAsText(curFile);\n\n      reader.onload = function (e) {\n        //console.log('file:', e.target.result);\n        let jsonData = JSON.parse(this.result); //console.log(jsonData.issuers[0].address);\n\n        that.setState({\n          certIssuer: jsonData.issuers[0].address\n        });\n        console.log(that.state.certIssuer);\n      }; // hash json\n\n\n      const reader2 = new FileReader();\n      reader2.readAsArrayBuffer(curFile);\n\n      reader2.onload = function (e) {\n        var wordArray = CryptoJS.lib.WordArray.create(reader2.result);\n        var hash = CryptoJS.SHA256(wordArray).toString();\n        that.setState({\n          hashValue: hash\n        });\n        console.log(that.state.hashValue, \"hash\");\n      };\n    });\n\n    _defineProperty(this, \"fileData\", () => {\n      if (this.state.selectedFile) {\n        return __jsx(\"div\", null, __jsx(\"h2\", null, \"File Details:\"), __jsx(\"p\", null, \"File Name: \", this.state.selectedFile.name), __jsx(\"p\", null, \"File Type: \", this.state.selectedFile.type));\n      }\n    });\n\n    _defineProperty(this, \"onClick\", async () => {\n      this.setState({\n        loading: true,\n        errorMessage: ''\n      }); //console.log(this.state.hashValue);\n\n      try {\n        const accounts = await web3.eth.getAccounts();\n        await verify.methods.upload(this.state.hashValue).send({\n          from: accounts[0]\n        });\n      } catch (err) {\n        this.setState({\n          errorMessage: err.message\n        });\n      }\n\n      this.setState({\n        loading: false\n      });\n    });\n\n    _defineProperty(this, \"onSubmit\", async event => {\n      event.preventDefault();\n      this.setState({\n        loading: true,\n        errorMessage: ''\n      });\n\n      try {\n        const accounts = await web3.eth.getAccounts();\n        await verify.methods.newSchool(this.state.newSchool).send({\n          from: accounts[0]\n        });\n      } catch (err) {\n        this.setState({\n          errorMessage: err.message\n        });\n      }\n\n      this.setState({\n        loading: false\n      });\n    });\n  }\n\n  render() {\n    return __jsx(Layout, null, __jsx(\"script\", {\n      src: \"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"\n    }), __jsx(\"h1\", null, \"Upload Certificates\"), __jsx(Link, {\n      route: \"/Academic/school/schoolList\"\n    }, __jsx(\"a\", null, __jsx(Button, {\n      floated: \"right\",\n      content: \"View All Schools\",\n      primary: true,\n      style: {\n        marginBottom: 20\n      }\n    }))), __jsx(Link, {\n      route: \"/Academic/school/students\"\n    }, __jsx(\"a\", null, __jsx(Button, {\n      floated: \"right\",\n      content: \"View All Transcripts\",\n      primary: true,\n      style: {\n        marginBottom: 20\n      }\n    }))), __jsx(\"br\", null), __jsx(Form, {\n      error: !!this.state.errorMessage\n    }, __jsx(\"h3\", null, \"Choose a JSON file\"), __jsx(\"input\", {\n      type: \"file\",\n      onChange: this.onFileChange,\n      accept: \"application/json\",\n      style: {\n        marginBottom: 20\n      }\n    }), this.fileData(), __jsx(\"a\", null, __jsx(Button, {\n      onClick: this.onClick,\n      loading: this.state.loading,\n      content: \"Upload\",\n      icon: \"upload\",\n      primary: true,\n      style: {\n        marginTop: 10,\n        marginBottom: 20\n      }\n    }))), __jsx(Form, {\n      onSubmit: this.onSubmit,\n      error: !!this.state.errorMessage\n    }, __jsx(Form.Field, null, __jsx(\"h3\", null, \"Add new school\"), __jsx(Input, {\n      value: this.state.newSchool,\n      onChange: event => this.setState({\n        newSchool: event.target.value\n      })\n    })), __jsx(\"a\", null, __jsx(Button, {\n      loading: this.state.loading,\n      content: \"Add\",\n      icon: \"add\",\n      primary: true\n    })), __jsx(Message, {\n      error: true,\n      header: \"Oops!\",\n      content: this.state.errorMessage\n    })));\n  }\n\n}\n\nexport default UploadIndex;","map":{"version":3,"sources":["C:/Users/user/Desktop/college/Blockchain/DApp/nextjs-web/pages/Academic/school/index.js"],"names":["React","Component","Button","Form","Input","Message","Link","Router","Layout","web3","verify","CryptoJS","UploadIndex","selectedFile","hashValue","newSchool","errorMessage","loading","event","setState","target","files","curFile","reader","FileReader","that","readAsText","onload","e","jsonData","JSON","parse","result","certIssuer","issuers","address","console","log","state","reader2","readAsArrayBuffer","wordArray","lib","WordArray","create","hash","SHA256","toString","name","type","accounts","eth","getAccounts","methods","upload","send","from","err","message","preventDefault","render","marginBottom","onFileChange","fileData","onClick","marginTop","onSubmit","value"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Button, Form, Input, Message } from 'semantic-ui-react';\r\nimport { Link, Router } from '../../../routes';\r\nimport Layout from '../../../components/Layout';\r\nimport web3 from '../../../ethereum/academic/web3';\r\nimport verify from '../../../ethereum/academic/verify';\r\nimport CryptoJS from 'crypto-js';\r\nclass UploadIndex extends Component {\r\n  state = {\r\n    selectedFile: null,\r\n    hashValue: '',\r\n    newSchool: '',\r\n    errorMessage: '',\r\n    loading: false\r\n  };\r\n\r\n  onFileChange = event => {\r\n    this.setState({\r\n      selectedFile: event.target.files[0],\r\n      errorMessage: ''\r\n    });\r\n\r\n    const curFile = event.target.files[0];\r\n    const reader = new FileReader();\r\n    var that = this;\r\n    reader.readAsText(curFile);\r\n    reader.onload = function (e) {\r\n      //console.log('file:', e.target.result);\r\n      let jsonData = JSON.parse(this.result);\r\n      //console.log(jsonData.issuers[0].address);\r\n      that.setState({ certIssuer: jsonData.issuers[0].address })\r\n      console.log(that.state.certIssuer);\r\n    };\r\n    // hash json\r\n    const reader2 = new FileReader();\r\n    reader2.readAsArrayBuffer(curFile);\r\n    reader2.onload = function (e) {\r\n      var wordArray = CryptoJS.lib.WordArray.create(reader2.result);\r\n      var hash = CryptoJS.SHA256(wordArray).toString();\r\n      that.setState({ hashValue: hash });\r\n      console.log(that.state.hashValue,\"hash\");\r\n    };\r\n  };\r\n\r\n  fileData = () => {\r\n    if (this.state.selectedFile) {\r\n      return (\r\n        <div>\r\n          <h2>File Details:</h2>\r\n          <p>File Name: {this.state.selectedFile.name}</p>\r\n          <p>File Type: {this.state.selectedFile.type}</p>\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  onClick = async () => {\r\n    this.setState({ loading: true, errorMessage: '' });\r\n    //console.log(this.state.hashValue);\r\n    try {\r\n      const accounts = await web3.eth.getAccounts();\r\n      await verify.methods.upload(this.state.hashValue).send({\r\n        from: accounts[0]\r\n      });\r\n    } catch (err) {\r\n      this.setState({ errorMessage: err.message });\r\n    }\r\n    this.setState({ loading: false });\r\n  };\r\n\r\n  onSubmit = async event => {\r\n    event.preventDefault();\r\n\r\n    this.setState({ loading: true, errorMessage: '' });\r\n    try {\r\n      const accounts = await web3.eth.getAccounts();\r\n      await verify.methods\r\n        .newSchool(this.state.newSchool)\r\n        .send({ from: accounts[0] });\r\n    } catch (err) {\r\n      this.setState({ errorMessage: err.message });\r\n    }\r\n\r\n    this.setState({ loading: false });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <Layout>\r\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\r\n        <h1>Upload Certificates</h1>\r\n        <Link route=\"/Academic/school/schoolList\">\r\n          <a>\r\n            <Button\r\n              floated=\"right\"\r\n              content='View All Schools'\r\n              primary={true}\r\n              style={{ marginBottom: 20 }}\r\n            />\r\n          </a>\r\n        </Link>\r\n        <Link route=\"/Academic/school/students\">\r\n          <a>\r\n            <Button\r\n              floated=\"right\"\r\n              content='View All Transcripts'\r\n              primary={true}\r\n              style={{ marginBottom: 20 }}\r\n            />\r\n          </a>\r\n        </Link>\r\n        <br />\r\n        <Form error={!!this.state.errorMessage}>\r\n          <h3>Choose a JSON file</h3>\r\n          <input\r\n            type=\"file\"\r\n            onChange={this.onFileChange}\r\n            accept=\"application/json\"\r\n            style={{ marginBottom: 20 }}\r\n          />\r\n          {this.fileData()}\r\n          <a>\r\n            <Button\r\n              onClick={this.onClick}\r\n              loading={this.state.loading}\r\n              content='Upload'\r\n              icon='upload'\r\n              primary={true}\r\n              style={{ marginTop: 10, marginBottom: 20 }}\r\n            />\r\n          </a>\r\n        </Form>\r\n        <Form onSubmit={this.onSubmit} error={!!this.state.errorMessage}>\r\n          <Form.Field>\r\n            <h3>Add new school</h3>\r\n            <Input\r\n              value={this.state.newSchool}\r\n              onChange={event =>\r\n                this.setState({ newSchool: event.target.value })}\r\n            />\r\n          </Form.Field>\r\n          <a>\r\n            <Button\r\n              loading={this.state.loading}\r\n              content='Add'\r\n              icon='add'\r\n              primary={true}\r\n            />\r\n          </a>\r\n          <Message error header=\"Oops!\" content={this.state.errorMessage} />\r\n        </Form>\r\n      </Layout>\r\n    );\r\n  }\r\n}\r\n\r\nexport default UploadIndex;"]},"metadata":{},"sourceType":"module"}