{"ast":null,"code":"var __jsx = React.createElement;\n//做一個頁面是沒有mailbox時要新增一個mailbox\nimport React, { Component } from 'react';\nimport { Link } from '../routes';\nimport Navbar from 'react-bootstrap/Navbar';\nimport Nav from 'react-bootstrap/Nav';\nimport Container from 'react-bootstrap/Nav';\nimport Form from 'react-bootstrap/Form';\nimport FormControl from 'react-bootstrap/FormControl';\nimport Button from 'react-bootstrap/Button';\nimport { Card, Table } from 'react-bootstrap';\nimport web3 from '../ethereum/web3';\nimport { Router } from '../routes';\nimport mailbox from '../ethereum/mailbox';\nimport vote from '../ethereum/vote'; //const header = [\"#\", \"vote name\", \"vote address\", \"due date\", \"link\"];\n\nclass Join extends Component {\n  //{this.props.joins.map(item => <td>{item}</td>)}\n  render() {\n    return __jsx(React.Fragment, null, __jsx(\"td\", null, this.props.joins[0]), __jsx(\"td\", null, this.props.joins[1]), __jsx(\"td\", null, __jsx(Link, {\n      route: \"/vote/\" + this.props.mb_addr + \"/\" + this.props.joins[2]\n    }, this.props.joins[2])), __jsx(\"td\", null, this.props.joins[3]), __jsx(\"td\", null, __jsx(Link, {\n      route: \"/vote/\" + this.props.mb_addr + \"/\" + this.props.joins[4]\n    }, \"link\")));\n  }\n\n}\n\nclass Join_list extends Component {\n  //const vote_btn =function (stage ){\n  render() {\n    return __jsx(React.Fragment, null, this.props.list.map(join => __jsx(\"tr\", null, __jsx(Join, {\n      joins: join,\n      mb_addr: this.props.mb_addr\n    }))));\n  }\n\n}\n\n;\n\nclass Self extends Component {\n  //{this.props.joins.map(item => <td>{item}</td>)}\n  constructor(props) {\n    super(props);\n    this.next = this.next.bind(this);\n  }\n\n  async next() {\n    const current_stage = this.props.selfs[4];\n    const v_address = this.props.selfs[2];\n    const accounts = await web3.eth.getAccounts();\n    const Vote_event = await vote(v_address);\n\n    if (current_stage == 0) {\n      //set up\n      await Vote_event.methods.set_can_register().send({\n        from: accounts[0]\n      });\n    } else if (current_stage == 1) {\n      //registry\n      await Vote_event.methods.set_can_vote().send({\n        from: accounts[0]\n      });\n    } else if (current_stage == 2) {\n      //vote\n      await Vote_event.methods.set_can_tally().send({\n        from: accounts[0]\n      });\n    } else {\n      //tally and finish\n      alert(\"current stage don't need other setting\");\n    }\n  }\n\n  render() {\n    return __jsx(React.Fragment, null, __jsx(\"td\", null, this.props.selfs[0]), __jsx(\"td\", null, this.props.selfs[1]), __jsx(\"td\", null, __jsx(Link, {\n      route: \"/vote/\" + this.props.mb_addr + \"/\" + this.props.selfs[2]\n    }, this.props.selfs[2])), __jsx(\"td\", null, this.props.selfs[3]), __jsx(\"td\", null, __jsx(Button, {\n      variant: \"primary\",\n      onClick: this.next\n    }, this.props.selfs[4] == 0 ? \"Set Register\" : this.props.selfs[4] == 1 ? \"Set Vote\" : this.props.selfs[4] == 2 ? \"Set Tally\" : this.props.selfs[4] == 3 ? \"Setting finish\" : \"Finish\")), __jsx(\"td\", null, __jsx(Link, {\n      route: \"/status/\" + this.props.mb_addr + \"/\" + this.props.selfs[2]\n    }, \"link\")), __jsx(\"td\", null, __jsx(Link, {\n      route: \"/admin/\" + this.props.mb_addr + \"/\" + this.props.selfs[2]\n    }, \"link\")));\n  }\n\n}\n\nclass Self_list extends Component {\n  //const vote_btn =function (stage ){\n  render() {\n    return __jsx(React.Fragment, null, this.props.list.map(self => __jsx(\"tr\", null, __jsx(Self, {\n      selfs: self\n    }))));\n  }\n\n}\n\n;\n\nclass Home extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      // Mb_addr :props.query.address,\n      search: \"\",\n      addr: \"\",\n      loading: false,\n      loading2: false,\n      errorMessage: ''\n    };\n    this.refresh_search = this.refresh_search.bind(this);\n    this.create_vote = this.create_vote.bind(this);\n    this.add_list = this.add_list.bind(this);\n  }\n\n  static async getInitialProps(props) {\n    const {\n      mb_addr\n    } = props.query; //const accounts = await web3.eth.getAccounts();\n\n    const Mailbox = mailbox(mb_addr);\n    let join = await Mailbox.methods.return_join_list().call(); //console.log(join);\n    //console.log(join.length);\n\n    var join_detail = [];\n\n    for (let index = 0; index < join.length; index++) {\n      let arr = [];\n      let v_addr = join[index];\n      let v = vote(v_addr);\n      arr[0] = (index + 1).toString();\n      arr[1] = await v.methods.return_question().call();\n      arr[2] = v_addr; //let t = await v.methods.return_time().call();\n      //console.log(t);\n\n      arr[3] = \"today\";\n      arr[4] = v_addr;\n      join_detail[index] = arr;\n    }\n\n    let self = await Mailbox.methods.return_self_list().call();\n    var self_detail = [];\n\n    for (let index = 0; index < self.length; index++) {\n      let arr = [];\n      let v_addr = self[index];\n      let v = vote(v_addr);\n      arr[0] = (index + 1).toString();\n      arr[1] = await v.methods.return_question().call();\n      arr[2] = v_addr; //arr[3] = await v.methods.return_time().call();\n\n      arr[3] = \"today\";\n      arr[4] = await v.methods.return_stage().call(); //return stage 之後要set stage\n\n      self_detail[index] = arr;\n    }\n\n    console.log(self); //console.log(join_detail);\n\n    return {\n      mb_addr,\n      join_detail,\n      self_detail\n    };\n  }\n\n  refresh_search() {\n    if (this.state.search != \"\") Router.pushRoute(`/vote/${this.state.search}`); //console.log(this.props.address);\n  }\n\n  async create_vote() {\n    const accounts = await web3.eth.getAccounts();\n    const Mailbox = await mailbox(this.props.mb_addr);\n    await Mailbox.methods.create_vote().send({\n      from: accounts[0]\n    });\n  }\n\n  async add_list() {\n    const accounts = await web3.eth.getAccounts();\n    const Mailbox = await mailbox(this.props.mb_addr);\n    await Mailbox.methods.add_to_join_list(this.state.addr).send({\n      from: accounts[0]\n    });\n  }\n\n  render() {\n    return __jsx(React.Fragment, null, __jsx(\"link\", {\n      rel: \"stylesheet\",\n      href: \"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css\",\n      integrity: \"sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk\",\n      crossOrigin: \"anonymous\"\n    }), __jsx(Container, null, __jsx(Navbar, {\n      bg: \"dark\",\n      variant: \"dark\",\n      style: {\n        width: \"100%\"\n      }\n    }, __jsx(Navbar.Brand, null, \"Vote\"), __jsx(Nav, {\n      className: \"mr-auto\",\n      style: {\n        width: \"50%\"\n      }\n    }, __jsx(Link, {\n      route: \"/index\"\n    }, __jsx(\"a\", {\n      style: {\n        color: \"white\",\n        width: \"100px\"\n      }\n    }, \"Logout\"))), __jsx(Form, {\n      inline: true\n    }, __jsx(\"div\", {\n      style: {\n        color: \"white\"\n      }\n    }, \" inesrt your vote contract address here  ->   \"), __jsx(FormControl, {\n      type: \"text\",\n      placeholder: \"Search\",\n      className: \"mr-sm-2\",\n      value: this.state.search,\n      onChange: event => this.setState({\n        search: event.target.value\n      })\n    }), __jsx(Button, {\n      variant: \"outline-info\",\n      onClick: this.refresh_search\n    }, \"Search\"))), __jsx(\"div\", {\n      style: {\n        width: '100%'\n      }\n    }, __jsx(\"h2\", {\n      style: {\n        width: '75%',\n        margin: \"auto\",\n        marginTop: \"3%\"\n      }\n    }, \"Vote List (the vote you are invited)\", __jsx(Form, {\n      inline: true\n    }, __jsx(\"h4\", null, \" add vote contract address to list  ->   \"), __jsx(FormControl, {\n      type: \"text\",\n      placeholder: \"add\",\n      className: \"mr-sm-2\",\n      value: this.state.addr,\n      onChange: event => this.setState({\n        addr: event.target.value\n      })\n    }), __jsx(Button, {\n      variant: \"primary\",\n      onClick: this.add_list\n    }, \"Add\"))), __jsx(Table, {\n      striped: true,\n      bordered: true,\n      hover: true,\n      size: \"sm\",\n      style: {\n        width: '75%',\n        margin: \"auto\",\n        marginTop: \"3%\"\n      }\n    }, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", null, \"#\"), __jsx(\"th\", null, \"vote name\"), __jsx(\"th\", null, \"vote address\"), __jsx(\"th\", null, \"due date\"), __jsx(\"th\", null, \"status\"))), __jsx(\"tbody\", null, __jsx(Join_list, {\n      list: this.props.join_detail,\n      mb_addr: this.props.mb_addr\n    })))), __jsx(\"div\", {\n      style: {\n        width: '100%'\n      }\n    }, __jsx(\"h2\", {\n      style: {\n        width: '75%',\n        margin: \"auto\",\n        marginTop: \"3%\"\n      }\n    }, \"Vote Admin List (the vote you create)\", __jsx(Button, {\n      variant: \"primary\",\n      onClick: this.create_vote\n    }, \"create new vote\")), __jsx(Table, {\n      striped: true,\n      bordered: true,\n      hover: true,\n      size: \"sm\",\n      style: {\n        width: '75%',\n        margin: \"auto\",\n        marginTop: \"3%\"\n      }\n    }, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", null, \"#\"), __jsx(\"th\", null, \"vote name\"), __jsx(\"th\", null, \"vote address\"), __jsx(\"th\", null, \"next step due date\"), __jsx(\"th\", null, \"nextstep\"), __jsx(\"th\", null, \"status\"), __jsx(\"th\", null, \"set question\"))), __jsx(\"tbody\", null, __jsx(Self_list, {\n      list: this.props.self_detail,\n      mb_addr: this.props.mb_addr\n    }))))));\n  }\n\n}\n\nexport default Home;","map":{"version":3,"sources":["/Users/suvincent/vote-web/pages/home.js"],"names":["React","Component","Link","Navbar","Nav","Container","Form","FormControl","Button","Card","Table","web3","Router","mailbox","vote","Join","render","props","joins","mb_addr","Join_list","list","map","join","Self","constructor","next","bind","current_stage","selfs","v_address","accounts","eth","getAccounts","Vote_event","methods","set_can_register","send","from","set_can_vote","set_can_tally","alert","Self_list","self","Home","state","search","addr","loading","loading2","errorMessage","refresh_search","create_vote","add_list","getInitialProps","query","Mailbox","return_join_list","call","join_detail","index","length","arr","v_addr","v","toString","return_question","return_self_list","self_detail","return_stage","console","log","pushRoute","add_to_join_list","width","color","event","setState","target","value","margin","marginTop"],"mappings":"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","sourcesContent":["//做一個頁面是沒有mailbox時要新增一個mailbox\r\nimport React, { Component } from 'react';\r\nimport{Link}from '../routes';\r\n\r\nimport Navbar from 'react-bootstrap/Navbar';\r\nimport Nav from 'react-bootstrap/Nav';\r\nimport Container from 'react-bootstrap/Nav';\r\nimport Form from 'react-bootstrap/Form';\r\nimport FormControl from 'react-bootstrap/FormControl';\r\nimport Button from 'react-bootstrap/Button';\r\nimport {Card,Table} from 'react-bootstrap';\r\nimport web3 from '../ethereum/web3'\r\nimport {Router}from '../routes';\r\nimport mailbox from '../ethereum/mailbox';\r\nimport vote from '../ethereum/vote';\r\n//const header = [\"#\", \"vote name\", \"vote address\", \"due date\", \"link\"];\r\nclass Join extends Component {\r\n  //{this.props.joins.map(item => <td>{item}</td>)}\r\n    render(){\r\n      return (\r\n        <>\r\n          <td>{this.props.joins[0]}</td>\r\n          <td>{this.props.joins[1]}</td>\r\n          <td><Link route={\"/vote/\"+this.props.mb_addr+\"/\"+this.props.joins[2]} >{this.props.joins[2]}</Link></td>\r\n          <td>{this.props.joins[3]}</td>\r\n          <td><Link route={\"/vote/\"+this.props.mb_addr+\"/\"+this.props.joins[4]} >link</Link></td>\r\n        </>\r\n      );\r\n    }\r\n}\r\nclass Join_list extends Component{\r\n  //const vote_btn =function (stage ){\r\n      render(){\r\n      return (\r\n          <>\r\n          {this.props.list.map(join => <tr><Join joins={join} mb_addr={this.props.mb_addr}></Join></tr>)}\r\n          </>\r\n      );\r\n      }\r\n};\r\nclass Self extends Component {\r\n  //{this.props.joins.map(item => <td>{item}</td>)}\r\n      constructor(props) {\r\n        super(props);\r\n        this.next = this.next.bind(this);\r\n      }\r\n      async next(){\r\n        const current_stage = this.props.selfs[4];\r\n        const v_address = this.props.selfs[2];\r\n        const accounts = await web3.eth.getAccounts();\r\n        const Vote_event =await vote(v_address);\r\n        if(current_stage == 0){//set up\r\n          await Vote_event.methods.set_can_register().send({from:accounts[0]});\r\n        }\r\n        else if(current_stage == 1){//registry\r\n          await Vote_event.methods.set_can_vote().send({from:accounts[0]});\r\n        }\r\n        else if(current_stage == 2){//vote\r\n          await Vote_event.methods.set_can_tally().send({from:accounts[0]});\r\n        }\r\n        else {//tally and finish\r\n          alert(\"current stage don't need other setting\")\r\n        }\r\n        \r\n      }\r\n    render(){\r\n      return (\r\n        <>  \r\n          <td>{this.props.selfs[0]}</td>\r\n          <td>{this.props.selfs[1]}</td>\r\n          <td><Link route={\"/vote/\"+this.props.mb_addr+\"/\"+this.props.selfs[2]} >{this.props.selfs[2]}</Link></td>\r\n          <td>{this.props.selfs[3]}</td>\r\n          <td><Button variant=\"primary\" \r\n            onClick={this.next}>\r\n              {(this.props.selfs[4] == 0)?\"Set Register\":\r\n               (this.props.selfs[4] == 1)?\"Set Vote\":\r\n               (this.props.selfs[4] == 2)?\"Set Tally\":\r\n               (this.props.selfs[4] == 3)?\"Setting finish\":\r\n               \"Finish\"}</Button></td>\r\n          <td><Link route={\"/status/\"+this.props.mb_addr+\"/\"+this.props.selfs[2]} >link</Link></td>\r\n          <td><Link route={\"/admin/\"+this.props.mb_addr+\"/\"+this.props.selfs[2]} >link</Link></td>\r\n        </>\r\n      );\r\n    }\r\n}\r\nclass Self_list extends Component{\r\n  //const vote_btn =function (stage ){\r\n      render(){\r\n      return (\r\n          <>\r\n          {this.props.list.map(self => <tr><Self selfs={self}></Self></tr>)}\r\n          </>\r\n      );\r\n      }\r\n};\r\nclass Home extends Component {\r\n        constructor(props) {\r\n          super(props);\r\n          this.state ={\r\n           // Mb_addr :props.query.address,\r\n            search : \"\",\r\n            addr:\"\",\r\n            loading : false,\r\n            loading2: false,\r\n            errorMessage:''\r\n          };\r\n          this.refresh_search = this.refresh_search.bind(this);\r\n          this.create_vote = this.create_vote.bind(this);\r\n          this.add_list = this.add_list.bind(this);\r\n        }\r\n        static async getInitialProps(props){\r\n          const{mb_addr} = props.query;\r\n          //const accounts = await web3.eth.getAccounts();\r\n          const Mailbox = mailbox(mb_addr);\r\n          let join = await Mailbox.methods.return_join_list().call();\r\n          //console.log(join);\r\n          //console.log(join.length);\r\n          var join_detail = [];\r\n          for (let index = 0; index < join.length; index++) {\r\n            let arr = [];\r\n            let v_addr = join[index];\r\n            let v = vote(v_addr);\r\n            arr[0] = (index+1).toString();\r\n            arr[1] = await v.methods.return_question().call();\r\n            arr[2] = v_addr;\r\n            //let t = await v.methods.return_time().call();\r\n            //console.log(t);\r\n            arr[3] = \"today\";\r\n            arr[4] = v_addr;\r\n            join_detail[index]=arr;\r\n          }\r\n          \r\n          let self = await Mailbox.methods.return_self_list().call();\r\n          var self_detail =[];\r\n          for (let index = 0; index < self.length; index++) {\r\n            let arr =[];\r\n            let v_addr = self[index];\r\n            let v = vote(v_addr);\r\n            arr[0] = (index+1).toString();\r\n            arr[1] = await v.methods.return_question().call();\r\n            arr[2] = v_addr;\r\n            //arr[3] = await v.methods.return_time().call();\r\n            arr[3] = \"today\";\r\n            arr[4] = await v.methods.return_stage().call();//return stage 之後要set stage\r\n            self_detail[index]=arr;\r\n            \r\n          }\r\n          console.log(self);\r\n          //console.log(join_detail);\r\n          return{mb_addr,join_detail,self_detail};\r\n      }\r\n    refresh_search(){\r\n       if(this.state.search != \"\")\r\n        Router.pushRoute(`/vote/${this.state.search}`);\r\n        //console.log(this.props.address);\r\n    }\r\n    async create_vote(){\r\n        const accounts = await web3.eth.getAccounts();\r\n        const Mailbox =await mailbox(this.props.mb_addr);\r\n        await Mailbox.methods.create_vote().send({from:accounts[0]});\r\n    }\r\n    async add_list(){\r\n      const accounts = await web3.eth.getAccounts();\r\n      const Mailbox =await mailbox(this.props.mb_addr);\r\n      await Mailbox.methods.add_to_join_list(this.state.addr).send({from:accounts[0]});\r\n    }\r\n    render() {\r\n      \r\n        return(\r\n          <>\r\n          <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css\" integrity=\"sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk\" crossOrigin=\"anonymous\"/>\r\n          <Container>\r\n          <Navbar bg=\"dark\" variant=\"dark\"style={{width:\"100%\"}}>\r\n             <Navbar.Brand >Vote</Navbar.Brand>\r\n              <Nav className=\"mr-auto\" style={{width:\"50%\"}}>\r\n                 <Link route={\"/index\" }  ><a style={{color: \"white\", width:\"100px\"}}>Logout</a></Link>\r\n              </Nav>\r\n             <Form inline>\r\n              <div style={{color : \"white\"}} > inesrt your vote contract address here  -&gt;   </div>\r\n              <FormControl type=\"text\" placeholder=\"Search\" className=\"mr-sm-2\"\r\n                  value={this.state.search} \r\n                  onChange = {event => this.setState({search:event.target.value})} />\r\n              <Button variant=\"outline-info\" onClick={this.refresh_search}>Search</Button>\r\n              </Form>\r\n         </Navbar>\r\n         \r\n         <div style={{width: '100%'}}>\r\n         <h2 style = {{width :'75%',margin:\"auto\",marginTop : \"3%\"}}>\r\n           Vote List (the vote you are invited)\r\n           <Form inline>\r\n              <h4> add vote contract address to list  -&gt;   </h4>\r\n              <FormControl type=\"text\" placeholder=\"add\" className=\"mr-sm-2\"\r\n                  value={this.state.addr} \r\n                  onChange = {event => this.setState({addr:event.target.value})} />\r\n              <Button variant=\"primary\" onClick={this.add_list}>Add</Button>\r\n              </Form>\r\n           </h2>\r\n         <Table striped bordered hover size=\"sm\" style = {{width :'75%',margin:\"auto\",marginTop : \"3%\"}}>\r\n          <thead>\r\n            <tr>\r\n              <th>#</th>\r\n              <th>vote name</th>\r\n              <th>vote address</th>\r\n              <th>due date</th>\r\n              <th>status</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody >\r\n          <Join_list list={this.props.join_detail} mb_addr={this.props.mb_addr}></Join_list>\r\n          </tbody>\r\n        </Table>\r\n        \r\n        </div>\r\n        <div style={{width: '100%'}}>\r\n        <h2 style = {{width :'75%',margin:\"auto\",marginTop : \"3%\"}}>\r\n          Vote Admin List (the vote you create)\r\n          <Button variant=\"primary\"  onClick={this.create_vote} >create new vote</Button>\r\n        </h2>\r\n        \r\n         <Table striped bordered hover size=\"sm\" style = {{width :'75%',margin:\"auto\",marginTop : \"3%\"}}>\r\n          <thead>\r\n            <tr>\r\n              <th>#</th>\r\n              <th>vote name</th>\r\n              <th>vote address</th>\r\n              <th>next step due date</th>\r\n              <th>nextstep</th>\r\n              <th>status</th>\r\n              <th>set question</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n          <Self_list list={this.props.self_detail} mb_addr={this.props.mb_addr}></Self_list>\r\n            {/* \r\n            <tr>\r\n              <td>1</td>\r\n              <td>should everyone wear mask on campus</td>\r\n              <td>0x1234556778999888</td>\r\n              <td>7/14</td>\r\n              <td><Link route=\"/vote\" >update setting</Link></td>\r\n            </tr>\r\n            <tr>\r\n              <td>2</td>\r\n              <td>should everyone wear mask on campus</td>\r\n              <td>0x1234556778999888</td>\r\n              <td>7/14</td>\r\n              <td><Link route=\"/vote\" >distribute vote contract</Link></td>\r\n            </tr>\r\n            <tr>\r\n              <td>3</td>\r\n              <td>should everyone wear mask on campus</td>\r\n              <td>0x1234556778999888</td>\r\n              <td>7/14</td>\r\n              <td><Link route=\"/vote\" >tally</Link></td>\r\n            </tr>*/}\r\n          </tbody>\r\n        </Table>\r\n        </div>\r\n       </Container>\r\n         </>\r\n    )\r\n    }\r\n}\r\n\r\n\r\nexport default Home;"]},"metadata":{},"sourceType":"module"}