{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport { Button, Form, Input, Message } from 'semantic-ui-react';\nimport Layout from '../../../components/Layout';\nimport { Link } from '../../../routes';\nimport web3 from '../../../ethereum/academic/web3';\nimport verify from '../../../ethereum/academic/verify';\n\nvar UploadIndex = /*#__PURE__*/function (_Component) {\n  _inherits(UploadIndex, _Component);\n\n  var _super = _createSuper(UploadIndex);\n\n  function UploadIndex() {\n    var _this;\n\n    _classCallCheck(this, UploadIndex);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      selectedFile: null,\n      hashValue: '',\n      newSchool: '',\n      message: '',\n      errorMessage: '',\n      loading: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onFileChange\", function (event) {\n      _this.setState({\n        selectedFile: event.target.files[0],\n        errorMessage: ''\n      });\n\n      var curFile = event.target.files[0];\n      var reader = new FileReader();\n\n      var that = _assertThisInitialized(_this);\n\n      reader.readAsText(curFile);\n\n      reader.onload = function (e) {\n        //console.log('file:', e.target.result);\n        var jsonData = JSON.parse(this.result); //console.log(jsonData);\n        // hash json\n\n        var reader = new FileReader();\n        reader.readAsArrayBuffer(curFile);\n\n        reader.onload = function (e) {\n          var wordArray = CryptoJS.lib.WordArray.create(reader.result);\n          var hash = CryptoJS.SHA256(wordArray).toString(); //this.state.hashValue = hash;\n\n          that.setState({\n            hashValue: hash\n          });\n          console.log(that.state.hashValue);\n        };\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"fileData\", function () {\n      if (_this.state.selectedFile) {\n        return __jsx(\"div\", null, __jsx(\"h2\", null, \"File Details:\"), __jsx(\"p\", null, \"File Name: \", _this.state.selectedFile.name), __jsx(\"p\", null, \"File Type: \", _this.state.selectedFile.type));\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onClick\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var accounts;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.setState({\n                loading: true,\n                errorMessage: ''\n              }); //console.log(this.state.hashValue);\n\n\n              _context.prev = 1;\n              _context.next = 4;\n              return web3.eth.getAccounts();\n\n            case 4:\n              accounts = _context.sent;\n              _context.next = 7;\n              return verify.methods.upload(_this.state.hashValue).send({\n                from: accounts[0]\n              });\n\n            case 7:\n              _context.next = 12;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](1);\n\n              _this.setState({\n                errorMessage: _context.t0.message\n              });\n\n            case 12:\n              _this.setState({\n                loading: false\n              });\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 9]]);\n    })));\n\n    return _this;\n  }\n\n  _createClass(UploadIndex, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return __jsx(Layout, null, __jsx(\"script\", {\n        src: \"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"\n      }), __jsx(\"h1\", null, \"Upload Certificates\"), __jsx(Form, {\n        error: !!this.state.errorMessage\n      }, __jsx(\"h3\", null, \"Choose a JSON file\"), __jsx(\"input\", {\n        type: \"file\",\n        onChange: this.onFileChange,\n        accept: \"application/json\",\n        style: {\n          marginBottom: 20\n        }\n      }), this.fileData(), __jsx(\"a\", null, __jsx(Button, {\n        onClick: this.onClick,\n        loading: this.state.loading,\n        content: \"Upload\",\n        icon: \"upload\",\n        primary: true,\n        style: {\n          marginTop: 10,\n          marginBottom: 20\n        }\n      })), __jsx(Form.Field, null, __jsx(\"h3\", null, \"Add new school\"), __jsx(Input, {\n        value: this.state.newSchool,\n        onChange: function onChange(event) {\n          return _this2.setState({\n            newSchool: event.target.value\n          });\n        }\n      })), __jsx(\"a\", null, __jsx(Button, {\n        content: \"Add\",\n        icon: \"add\",\n        primary: true\n      })), __jsx(\"h1\", null, this.state.message), __jsx(Message, {\n        error: true,\n        header: \"Oops!\",\n        content: this.state.errorMessage\n      })));\n    }\n  }]);\n\n  return UploadIndex;\n}(Component);\n\nexport default UploadIndex;","map":{"version":3,"sources":["C:/Users/user/Desktop/college/Blockchain/DApp/nextjs-web/pages/Academic/school/index.js"],"names":["React","Component","Button","Form","Input","Message","Layout","Link","web3","verify","UploadIndex","selectedFile","hashValue","newSchool","message","errorMessage","loading","event","setState","target","files","curFile","reader","FileReader","that","readAsText","onload","e","jsonData","JSON","parse","result","readAsArrayBuffer","wordArray","CryptoJS","lib","WordArray","create","hash","SHA256","toString","console","log","state","name","type","eth","getAccounts","accounts","methods","upload","send","from","onFileChange","marginBottom","fileData","onClick","marginTop","value"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Button, Form, Input, Message } from 'semantic-ui-react';\r\nimport Layout from '../../../components/Layout';\r\nimport { Link } from '../../../routes';\r\nimport web3 from '../../../ethereum/academic/web3';\r\nimport verify from '../../../ethereum/academic/verify';\r\n\r\nclass UploadIndex extends Component {\r\n  state = { \r\n    selectedFile: null,\r\n    hashValue: '',\r\n    newSchool: '',\r\n    message: '',\r\n    errorMessage: '',\r\n    loading: false\r\n  };\r\n\r\n  onFileChange = event => {\r\n    this.setState({ \r\n      selectedFile: event.target.files[0],\r\n      errorMessage: ''\r\n    });\r\n\r\n    const curFile = event.target.files[0];\r\n    const reader = new FileReader();\r\n    var that = this;\r\n    reader.readAsText(curFile);\r\n    reader.onload = function (e) {\r\n      //console.log('file:', e.target.result);\r\n      let jsonData = JSON.parse(this.result);\r\n      //console.log(jsonData);\r\n\r\n      // hash json\r\n      let reader = new FileReader();\r\n      reader.readAsArrayBuffer(curFile);\r\n      reader.onload = function (e) {\r\n        var wordArray = CryptoJS.lib.WordArray.create(reader.result);\r\n        var hash = CryptoJS.SHA256(wordArray).toString();\r\n        //this.state.hashValue = hash;\r\n        that.setState({ hashValue: hash });\r\n        console.log(that.state.hashValue);\r\n      };\r\n    };\r\n  };\r\n\r\n  fileData = () => {\r\n    if (this.state.selectedFile) {\r\n      return (\r\n        <div>\r\n          <h2>File Details:</h2>\r\n          <p>File Name: {this.state.selectedFile.name}</p>\r\n          <p>File Type: {this.state.selectedFile.type}</p>\r\n        </div>\r\n      );\r\n    }\r\n  };\r\n\r\n  onClick = async () => {\r\n    this.setState({ loading: true, errorMessage: '' });\r\n    //console.log(this.state.hashValue);\r\n    try {\r\n      const accounts = await web3.eth.getAccounts();\r\n      await verify.methods.upload(this.state.hashValue).send({\r\n        from: accounts[0]\r\n      });\r\n    } catch (err) {\r\n      this.setState({ errorMessage: err.message });\r\n    }\r\n    this.setState({ loading: false });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Layout>\r\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js\"></script>\r\n        <h1>Upload Certificates</h1>\r\n        <Form error={!!this.state.errorMessage}>\r\n          <h3>Choose a JSON file</h3>\r\n          <input\r\n            type=\"file\"\r\n            onChange={this.onFileChange}\r\n            accept=\"application/json\"\r\n            style={{ marginBottom: 20 }}\r\n          />\r\n          {this.fileData()}\r\n          {/* <Link route={`/Academic/school/${this.hashValue}/success`}> */}\r\n            <a>\r\n              <Button\r\n                onClick={this.onClick}\r\n                loading={this.state.loading}\r\n                content='Upload'\r\n                icon='upload'\r\n                primary={true}\r\n                style={{ marginTop: 10, marginBottom: 20 }}\r\n              />\r\n            </a>\r\n          {/* </Link> */}\r\n          <Form.Field>\r\n            <h3>Add new school</h3>\r\n            <Input\r\n              value={this.state.newSchool}\r\n              onChange={event =>\r\n                this.setState({ newSchool: event.target.value })}\r\n            />\r\n          </Form.Field>\r\n          <a>\r\n              <Button\r\n                content='Add'\r\n                icon='add'\r\n                primary={true}\r\n              />\r\n            </a>\r\n          <h1>{this.state.message}</h1>\r\n          <Message error header=\"Oops!\" content={this.state.errorMessage} />\r\n        </Form>\r\n      </Layout>\r\n    );\r\n  }\r\n}\r\n\r\nexport default UploadIndex;"]},"metadata":{},"sourceType":"module"}